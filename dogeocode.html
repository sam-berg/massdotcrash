<!DOCTYPE html>
<html>
<head>
    <title>Massachusetts Crash Reporting Form</title>
    <meta charset="utf-8" />

    <link rel="stylesheet" href="https://js.arcgis.com/3.20/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="https://js.arcgis.com/3.20/esri/css/esri.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 20px;
            padding: 0px;
            width: 100%;
            color: #353129;
            overflow: none;
            overflow: hidden;
            font-size:12px;
        }

        .highwayRowTitle{
            height:40px;
            border-bottom:3px solid;
        }

        .highwayField{
            width: 200px;
            float: left;
            text-decoration:underline
        }

        .highwayValue{
            width: 50%;
            float: left;
            font-weight:bold; 
        }

        .llValue{
           font-weight:bold;
        }
        input:focus::-webkit-input-placeholder 
{
    color: transparent;
}

        #tab-content{
            height:500px;
        }
        #results {
            /*height: 350px;
            overflow-y: auto;*/
        }
        .input-group{
            border:2px solid #000;
            padding:10px;
        }
        .input-label{
                width: 150px;
        }
        .input-value{
            margin-left:10px;
            width:100%;
        }
        #search {
            display: block;
        }

        .simpleGeocoder .esriGeocoderContainer {
            width: 400px;
        }
        .simpleGeocoder .esriGeocoderContainer input {
            width:300px;
        }
        #searchRow {
            margin: 30px;
            /*margin-left: 95px;*/
        }

        #headerRow {
            padding: 10px;
        }

        #mainInput {
            height: 500px;
            min-width:930px;
            overflow-wrap: break-word;
        }

        #inputRow {
            margin: 30px;
            display: block;
        }

        #mainRow {
            margin: 30px;
            overflow-wrap: break-word;
        }

        #resultsdiv {
    height: 500px;
    overflow-y: scroll;
    margin-right: 50px;
        }

        #currentextent {
            display: none;
        }

        fieldset {
            border: 1px solid #353129;
            color: #353129;
            padding: 20px;
        }

        #map {
            margin: 0 auto !important;
            padding: 0;
        }

        #t1 {
            overflow-y: auto;
        }
    </style>

    <script src="https://js.arcgis.com/3.20/"></script>
    <script>
        var locator, map;

        require([
          "esri/map", "esri/tasks/locator",
          "esri/dijit/Geocoder",
          "esri/tasks/query",
          "esri/tasks/QueryTask",
          "esri/request",
          "esri/SpatialReference", "esri/graphic","esri/graphicsUtils",
          "esri/symbols/SimpleLineSymbol", "esri/symbols/SimpleMarkerSymbol",
          "esri/symbols/Font", "esri/symbols/TextSymbol",
          "esri/geometry/Point", "esri/geometry/Extent",
          "esri/geometry/webMercatorUtils",
          "dojo/_base/array", "esri/Color",
          "dojo/number", "dojo/parser", "dojo/dom", "dojo/json", "dijit/registry",
          "dojo/_base/lang",
          "dijit/form/Button", "dijit/form/Textarea",
          "dijit/layout/BorderContainer", "dijit/layout/ContentPane", "dojo/domReady!"
        ], function (
          Map, Locator, Geocoder,
          Query, QueryTask,
          esriRequest,
          SpatialReference, Graphic,graphicsUtils,
          SimpleLineSymbol, SimpleMarkerSymbol,
          Font, TextSymbol,
          Point, Extent,
          webMercatorUtils,
          arrayUtils, Color,
          number, parser, dom, JSON, registry,lang
        ) {
            parser.parse();

            //{"xmin":-8181819.507643144,"ymin":5080281.0561183,"xmax":-7785569.953012895,"ymax":5284520.795696237,"spatialReference":{"wkid":102100}}

            map = new Map("map", {
                basemap: "topo",
                extent: new Extent({"xmin":-8181819.507643144,"ymin":5080281.0561183,"xmax":-7785569.953012895,"ymax":5284520.795696237,"spatialReference":{"wkid":102100}})
            
            });

            locator = new Locator("https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer");

            var geocoder;
            if (0 == 1) {
                geocoder = new Geocoder({
                    map: null,
                    arcgisGeocoder: false,
                    geocoders: [{
                        url: "http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Locators/ESRI_Geocode_USA/GeocodeServer",
                        name: "Esri Geocoder USA",
                        placeholder: "Locate",
                        outFields: "*"
                    }],
                    autoComplete: true,
                }, dom.byId("search"));
            }
            else {
                geocoder = new Geocoder({
                    map: map,
                    arcgisGeocoder: true,
                    autoComplete: true,
                    autoNavigate:false,
                }, dom.byId("search"));
            }



            geocoder.startup();
            geocoder.on("find-results", function (res) {
                //showResults2(res);
            });
            geocoder.on("select", function (res) {
                //showResults2([res]);
            });

            dojo.connect(geocoder, "onFindResults", function (response) {
                map.graphics.clear();
                showResults3(response.results);
            });

            registry.byId("locate").on("click", locate);

            registry.byId("btnAddress").on("click", setupAddressUI);
            registry.byId("btnIntersection").on("click", setupIntersectionUI);
            registry.byId("btnMileMarker").on("click", setupMileMarkerUI);
            registry.byId("btnLandmarks").on("click", setupLandmarksUI);

            //Draw and zoom to the result when the geocoding is complete
            locator.on("address-to-locations-complete", function (evt) {
                map.graphics.clear();
                arrayUtils.forEach(evt.addresses, function (geocodeResult, index) {
                    //create a random color for the text and marker symbol
                    var r = Math.floor(Math.random() * 250);
                    var g = Math.floor(Math.random() * 100);
                    var b = Math.floor(Math.random() * 100);

                    var symbol = new SimpleMarkerSymbol(
                      SimpleMarkerSymbol.STYLE_CIRCLE,
                      20,
                      new SimpleLineSymbol(
                        SimpleLineSymbol.STYLE_SOLID,
                        new Color([r, g, b, 0.5]),
                        10
                      ), new Color([r, g, b, 0.9]));
                    var pointMeters = webMercatorUtils.geographicToWebMercator(geocodeResult.location);
                    var locationGraphic = new Graphic(pointMeters, symbol);

                    var font = new Font().setSize("12pt").setWeight(Font.WEIGHT_BOLD);
                    var textSymbol = new TextSymbol(
                      (index + 1) + ".) " + geocodeResult.address,
                      font,
                      new Color([r, g, b, 0.8])
                    ).setOffset(5, 15);
                    //add the location graphic and text with the address to the map
                    map.graphics.add(locationGraphic);
                    map.graphics.add(new Graphic(pointMeters, textSymbol));
                });
                var ptAttr = evt.addresses[0].attributes;
                var minx = parseFloat(ptAttr.Xmin);
                var maxx = parseFloat(ptAttr.Xmax);
                var miny = parseFloat(ptAttr.Ymin);
                var maxy = parseFloat(ptAttr.Ymax);

                var esriExtent = new Extent(minx, miny, maxx, maxy, new SpatialReference({ wkid: 4326 }));
                map.setExtent(webMercatorUtils.geographicToWebMercator(esriExtent));

                showResults(evt.addresses);
            });

            $('#myTabs a:last').tab('show');

            map.on("extent-change", updateExtent);

            function updateExtent() {
                dom.byId("currentextent").innerHTML = "<b>Current Extent JSON:</b> " + JSON.stringify(map.extent.toJson());
                dom.byId("currentextent").innerHTML += "<br/><b>Current Zoom level:</b> " + map.getLevel();
            }
            function showResults3(results) {
                var rdiv = dom.byId("resultsdiv");
                rdiv.innerHTML = "<p><b>Results : " + results.length + "</b></p>";

                var content = [];
                //arrayUtils.forEach(results, function (result, index) {
                for (var i = 0; i < results.length; i++) {
                    var result = results[i];
                    result.location = result.feature.geometry;
                    result.address = result.name;
                    result.score = result.feature.attributes.score;


                    var location_wm = result.location;//webMercatorUtils.geographicToWebMercator(result.location);
                    var location_xy = webMercatorUtils.webMercatorToGeographic(result.location);

                    var x = location_xy.x.toFixed(5);
                    var y = location_xy.y.toFixed(5);
                    content.push("<fieldset>");
                    content.push("<legend><b>" + (i + 1) + ". " + result.address + "</b></legend>");
                    content.push("<i>Score:</i> " + result.score);
                    content.push("<br/>");

                    //if(result.feature.attributes.Loc_name)
                    //    content.push("<i>Address Found In</i> :<b> " + result.feature.attributes.Loc_name + "</b>");

                    content.push("<br/><br/>");
                    content.push("Latitude (y): " + y);
                    content.push("&nbsp;&nbsp;");
                    content.push("Longitude (x): " + x);
                    content.push("<br/><br/>");
                    //content.push("<b>GeoRSS-Simple</b><br/>");
                    //content.push("&lt;georss:point&gt;" + y + " " + x + "&lt;/georss:point&gt;");
                    //content.push("<br/><br/>");
                    //content.push("<b>GeoRSS-GML</b><br/>");
                    //content.push("&lt;georss:where&gt;&lt;gml:Point&gt;&lt;gml:pos&gt;" + y + " " + x + "&lt;/gml:pos&gt;&lt;gml:Point&gt;&lt;/georss:where&gt;");
                    //content.push("<br/><br/>");
                    //content.push("<b>Esri JSON</b><br/>");
                    //content.push("<b>WGS:</b> " + JSON.stringify(result.location.toJson()));
                    //content.push("<br/>");

                    //content.push("<b>WM:</b> " + JSON.stringify(location_wm.toJson()));
                    //content.push("<br/><br/>");
                    //content.push("<b>Geo JSON</b><br/>");
                    //content.push('"geometry": {"type": "Point", "coordinates": [' + y + ',' + x + ']}');
                    content.push("<br/><br/>");
                    content.push("<input type='button' value='Center At Address' onclick='zoomTo(" + location_xy.y + "," + location_xy.x + ")'/>");
                    //content.push("<input style='margin-left:10px;' type='button' value='Lookup' onclick='doSelect(" + location_xy.y + "," + location_xy.x + ")'/>");

                    content.push("</fieldset>");

                    var gR = {};
                    gR.location = location_xy;
                    gR.address = result.address;
                    showLocation(gR);
                }

                //zoom to extent of graphics
                var myFeatureExtent = graphicsUtils.graphicsExtent(map.graphics.graphics);
                map.setExtent(myFeatureExtent);

                rdiv.innerHTML += content.join("");
            }
            function showResults2(results) {
                var rdiv = dom.byId("resultsdiv");
                rdiv.innerHTML = "<p><b>Results : " + results.length + "</b></p>";

                var content = [];
                //arrayUtils.forEach(results, function (result, index) {
                for(var i=0;i<results.length;i++){
                    var result=results[i];
                    result.location = result.result.feature.geometry;
                    result.address = result.result.name;
                    result.score = result.result.feature.attributes.score;


                    var location_wm = result.location;//webMercatorUtils.geographicToWebMercator(result.location);
                    var location_xy = webMercatorUtils.webMercatorToGeographic(result.location);

                    var x = location_xy.x.toFixed(5);
                    var y = location_xy.y.toFixed(5);
                    content.push("<fieldset>");
                    content.push("<legend><b>" + (i + 1) + ". " + result.address + "</b></legend>");
                    content.push("<i>Score:</i> " + result.score);
                    content.push("<br/>");
                    content.push("<i>Address Found In</i> : " + result.address);
                    content.push("<br/><br/>");
                    content.push("Latitude (y): " + y);
                    content.push("&nbsp;&nbsp;");
                    content.push("Longitude (x): " + x);
                    content.push("<br/><br/>");
                    //content.push("<b>GeoRSS-Simple</b><br/>");
                    //content.push("&lt;georss:point&gt;" + y + " " + x + "&lt;/georss:point&gt;");
                    //content.push("<br/><br/>");
                    //content.push("<b>GeoRSS-GML</b><br/>");
                    //content.push("&lt;georss:where&gt;&lt;gml:Point&gt;&lt;gml:pos&gt;" + y + " " + x + "&lt;/gml:pos&gt;&lt;gml:Point&gt;&lt;/georss:where&gt;");
                    //content.push("<br/><br/>");
                    //content.push("<b>Esri JSON</b><br/>");
                    //content.push("<b>WGS:</b> " + JSON.stringify(result.location.toJson()));
                    //content.push("<br/>");

                    //content.push("<b>WM:</b> " + JSON.stringify(location_wm.toJson()));
                    //content.push("<br/><br/>");
                    //content.push("<b>Geo JSON</b><br/>");
                    //content.push('"geometry": {"type": "Point", "coordinates": [' + y + ',' + x + ']}');
                    content.push("<br/><br/>");
                    content.push("<input type='button' value='Center At Address' onclick='zoomTo(" + location_xy.y + "," + location_xy.x + ")'/>");
                    content.push("</fieldset>");

                    var gR = {};
                    gR.location = result.location;;
                    gR.address = result.address;
                    showLocation(gR);
                }
                rdiv.innerHTML += content.join("");
            }
            function showResults(results) {
                var rdiv = dom.byId("resultsdiv");
                rdiv.innerHTML = "<p><b>Results : " + results.length + "</b></p>";

                var content = [];
                arrayUtils.forEach(results, function (result, index) {
                    var x = result.location.x.toFixed(5);
                    var y = result.location.y.toFixed(5);
                    content.push("<fieldset>");
                    content.push("<legend><b>" + (index + 1) + ". " + result.address + "</b></legend>");
                    content.push("<i>Score:</i> " + result.score);
                    content.push("<br/>");
                    content.push("<i>Address Found In</i> :<b> " + result.attributes.Loc_name + "</b>");
                    content.push("<br/>");
                    content.push("Latitude (y): " + y);
                    content.push("&nbsp;&nbsp;");
                    content.push("Longitude (x): " + x);
                    content.push("<br/><br/>");
                    //content.push("<b>GeoRSS-Simple</b><br/>");
                    //content.push("&lt;georss:point&gt;" + y + " " + x + "&lt;/georss:point&gt;");
                    //content.push("<br/><br/>");
                    //content.push("<b>GeoRSS-GML</b><br/>");
                    //content.push("&lt;georss:where&gt;&lt;gml:Point&gt;&lt;gml:pos&gt;" + y + " " + x + "&lt;/gml:pos&gt;&lt;gml:Point&gt;&lt;/georss:where&gt;");
                    //content.push("<br/><br/>");
                    //content.push("<b>Esri JSON</b><br/>");
                    //content.push("<b>WGS:</b> " + JSON.stringify(result.location.toJson()));
                    //content.push("<br/>");

                    var location_wm = webMercatorUtils.geographicToWebMercator(result.location);

                    //content.push("<b>WM:</b> " + JSON.stringify(location_wm.toJson()));
                    //content.push("<br/><br/>");
                    //content.push("<b>Geo JSON</b><br/>");
                    //content.push('"geometry": {"type": "Point", "coordinates": [' + y + ',' + x + ']}');
                    content.push("<br/><br/>");
                    content.push("<input type='button' value='Center At Address' onclick='zoomTo(" + y + "," + x + ")'/>");

                    //content.push("<input type='button' value='Center At Address' onclick='zoomTo(" + y + "," + x + ")'/>");
                    content.push("</fieldset>");
                });
                rdiv.innerHTML += content.join("");
            }
            function showResults4(results) {
                var rdiv = dom.byId("resultsdiv");
                rdiv.innerHTML = "<p><b>Results : " + results.length + "</b></p>";
                map.graphics.clear();
                var content = [];
                arrayUtils.forEach(results, function (result, index) {
                    var x = result.geometry.x.toFixed(5);
                    var y = result.geometry.y.toFixed(5);
                    content.push("<fieldset>");
                    content.push("<legend><b>" + (index + 1) + ". " + result.attributes.intersectionname + "</b></legend>");
                    content.push("<i>Score:</i> " + "100");
                    content.push("<br/>");
                    content.push("<i>Address Found In</i> : " + result.attributes.intersectionname);
                    content.push("<br/><br/>");
                    content.push("Latitude (y): " + y);
                    content.push("&nbsp;&nbsp;");
                    content.push("Longitude (x): " + x);
                    content.push("<br/><br/>");


                    content.push("<div id='divHighway'><b>Highway Information ------<br/><br/>");
                    content.push("Route: " + result.attributes.routeid + "<br/><br/>");
                    content.push("Measure: " + result.attributes.measure + "<br/><br/>");
                    content.push("-----------------" + "</b></div><br/><br/>");

                    //content.push("<b>GeoRSS-Simple</b><br/>");
                    //content.push("&lt;georss:point&gt;" + y + " " + x + "&lt;/georss:point&gt;");
                    //content.push("<br/><br/>");
                    //content.push("<b>GeoRSS-GML</b><br/>");
                    //content.push("&lt;georss:where&gt;&lt;gml:Point&gt;&lt;gml:pos&gt;" + y + " " + x + "&lt;/gml:pos&gt;&lt;gml:Point&gt;&lt;/georss:where&gt;");
                    //content.push("<br/><br/>");
                    //content.push("<b>Esri JSON</b><br/>");
                    //content.push("<b>WGS:</b> " + JSON.stringify(result.location.toJson()));
                    //content.push("<br/>");

                    var location_wm = webMercatorUtils.geographicToWebMercator(result.geometry);

                    //content.push("<b>WM:</b> " + JSON.stringify(location_wm.toJson()));
                    //content.push("<br/><br/>");
                    //content.push("<b>Geo JSON</b><br/>");
                    //content.push('"geometry": {"type": "Point", "coordinates": [' + y + ',' + x + ']}');
                    content.push("<br/><br/>");
                    var rid = result.attributes.routeid;
                    var measure = result.attributes.measure;
                    var offset = 0;

                    content.push("<input type='button' value='Center At Address' onclick='zoomTo(" + y + "," + x + ")'/>");
                    //content.push("<input style='margin-left:10px;' type='button' value='Select' onclick='doRouteLookup(" + "\"" + rid + "\"" + "," + measure + "," + offset + ")'/>");

                    //content.push("<input type='button' value='Center At Address' onclick='zoomTo(" + y + "," + x + ")'/>");
                    content.push("</fieldset>");

                    var gR = {};
                    gR.location = result.geometry;
                    gR.address = result.attributes.intersectionname;
                    showLocation(gR);

                });
                rdiv.innerHTML += content.join("");
            }
            function showResults5(results) {
                var rdiv = dom.byId("resultsdiv");
                rdiv.innerHTML = "<p><b>Results : " + results.length + "</b></p>";
                map.graphics.clear();
                var content = [];

                arrayUtils.forEach(results, function (result, index) {
                    var x = result.geometry.x.toFixed(5);
                    var y = result.geometry.y.toFixed(5);
                    var name = result.attributes["route_id"] + " - Mile Marker " + result.attributes["mile_point"];
                    content.push("<fieldset>");
                    content.push("<legend><b>" + (index + 1) + ". " + name + "</b></legend>");
                    content.push("<i>Score:</i> " + "100");
                    content.push("<br/>");
                    content.push("<i>Address Found In</i> : " + name);
                    content.push("<br/><br/>");
                    content.push("<div>Latitude (y):<div class='llValue'> " + y + "</div></div>");
                    content.push("&nbsp;&nbsp;");
                    content.push("<div>Longitude (x):<div class='llValue'>" + x + "</div></div>");
                    content.push("<br/><br/>");

                    var sIndex = index.toString();
                    content.push("<div id='divLRSInfo' class='highwayRowTitle' style='display:none'><b>Highway Information</b></div><br/>");
                    content.push("<div class='highwayRow'><div class='highwayField'>Name:</div> " + "<span class='highwayValue' id='divName" + sIndex +"'></span></div>" + "<br/>");
                    content.push("<div class='highwayRow'><div class='highwayField'>Route: </div> <span class='highwayValue'>" + result.attributes.route_id + "</span></div><br/>");
                    content.push("<div class='highwayRow'><div class='highwayField'>Measure:</div> <span class='highwayValue'>" + result.attributes.measure + "</span></div><br/>");
                    content.push("<div class='highwayRow'><div class='highwayField'>Number of Lanes: </div>" + "<span class='highwayValue' id='divLanes" + sIndex + "'></span></div>" + "<br/>");
                    content.push("<div class='highwayRow'><div class='highwayField'>Speed Limit: </div>" + "<span class='highwayValue' id='divSpeedLimit" + sIndex + "'></span></div>" + "<br/>");

                    content.push("<div class='highwayRow'><div class='highwayField'>Functional Type:</div> " + "<span class='highwayValue' id='divFunctionalType" + sIndex + "'></span></div>" + "<br/>");
                    content.push("<div class='highwayRow'><div class='highwayField'>Functional Class: </div>" + "<span class='highwayValue' id='divFunctionalClass" + sIndex + "'></span></div>" + "<br/>");

                    content.push("<div class='highwayRow'><div class='highwayField'>Lane Width: </div>" + "<span class='highwayValue' id='divLaneWidth" + sIndex + "'></span></div>" + "<br/>");
                    content.push("<div class='highwayRow'><div class='highwayField'>Median Type Code: </div>" + "<span class='highwayValue' id='divMedianType" + sIndex + "'></span></div>" + "<br/>");
                    content.push("<div class='highwayRow'><div class='highwayField'>Left Shoulder Width: </div>" + "<span class='highwayValue' id='divShoulderL" + sIndex + "'></span></div>" + "<br/>");
                    content.push("<div class='highwayRow'><div class='highwayField'>Right Shoulder Width: </div>" + "<span class='highwayValue' id='divShoulderR" + sIndex + "'></span></div>" + "<br/>");

                    content.push("" + "</b></div><br/><br/>");

                    //content.push("<b>GeoRSS-Simple</b><br/>");
                    //content.push("&lt;georss:point&gt;" + y + " " + x + "&lt;/georss:point&gt;");
                    //content.push("<br/><br/>");
                    //content.push("<b>GeoRSS-GML</b><br/>");
                    //content.push("&lt;georss:where&gt;&lt;gml:Point&gt;&lt;gml:pos&gt;" + y + " " + x + "&lt;/gml:pos&gt;&lt;gml:Point&gt;&lt;/georss:where&gt;");
                    //content.push("<br/><br/>");
                    //content.push("<b>Esri JSON</b><br/>");
                    //content.push("<b>WGS:</b> " + JSON.stringify(result.location.toJson()));
                    //content.push("<br/>");

                    var location_wm = webMercatorUtils.geographicToWebMercator(result.geometry);

                    //content.push("<b>WM:</b> " + JSON.stringify(location_wm.toJson()));
                    //content.push("<br/><br/>");
                    //content.push("<b>Geo JSON</b><br/>");
                    //content.push('"geometry": {"type": "Point", "coordinates": [' + y + ',' + x + ']}');
                    content.push("<br/><br/>");
                    var rid = result.attributes.route_id;
                    var measure = result.attributes.measure;
                    var offset = dojo.byId("offset").value;
                    var direction = dojo.byId("direction").value;


                    content.push("<input type='button' value='Center At Address' onclick='zoomTo(" + y + "," + x + ")'/>");
                    //content.push("<input style='margin-left:10px;' type='button' value='Select' onclick='doRouteLookup(" + sIndex +"," + "\"" + rid + "\"" + "," + measure + "," + offset + "," + "\"" + direction + "\"" + ")'/>");

                    
                    //content.push("<input id='btnSelect" + index.toString() + "' style='margin-left:10px;' type='button' value='Select' />");
                    //onclick='doRouteLookup(" + sIndex + "," + "\"" + rid + "\"" + "," + measure + "," + offset + "," + "\"" + direction + "\"" + ")

                    //content.push("<input type='button' value='Center At Address' onclick='zoomTo(" + y + "," + x + ")'/>");
                    content.push("</fieldset>");

                    var gR = {};
                    gR.location = result.geometry;
                    gR.address = name;

                    gR.MYINDEX = index.toString();
                    var a = { "MYID": index.toString() };

                    map.graphics.setOpacity(0);
                    showLocation(gR,a);


                    //
                    if (0 == 0) {


                        doRouteLookup(sIndex, rid, measure, offset, direction);

                    }
                });
                rdiv.innerHTML += content.join("");
            }
            function showResults55(results) {

                if (results.length < 1) {
                    alert("Landmark was not found.");
                    return;
                }
                var rdiv = dom.byId("resultsdiv");
                rdiv.innerHTML = "<p><b>Results : " + results.length + "</b></p>";
                map.graphics.clear();
                var content = [];

                arrayUtils.forEach(results, function (result, index) {
                    var x = result.geometry.x.toFixed(5);
                    var y = result.geometry.y.toFixed(5);


                    //XY to route measure
                    //var sLayerURL = "https://dot2.esri.com/arcgis/rest/services/MassDOT/MassDOTLRSMap/MapServer/exts/LRSServer/networkLayers/0/geometryToMeasure";
                    var sLayerURL = "https://dot2.esri.com/arcgis/rest/services/Massachusetts/MassDOTLRSMap/MapServer/exts/LRSServer/networkLayers/0/geometryToMeasure";
                    
                    var locations="?locations=[{'geometry':{'x':" + x + ",'y':" + y +"}}]&tolerance=100&inSR=102100";
                    var sURL = sLayerURL + locations;

                    var layersRequest = esri.request({
                        url: sURL,
                        content: { f: "json" },
                        handleAs: "json",
                        callbackParamName: "callback"
                    });


                    layersRequest.then(function(newResults){

                        var measure = "";
                        var rid = "";
                        var geomLL = webMercatorUtils.webMercatorToGeographic(result.geometry);
                        var name = result.attributes["landmark_name"];

                        var bLookupHighway = false;
                        if (newResults.locations[0].results.length >0) {
 
                            measure = newResults.locations[0].results[0].measure;
                            rid = newResults.locations[0].results[0].routeId;
                            //geomLL = webMercatorUtils.webMercatorToGeographic(result.geometry);
                            //name = result.attributes["landmark_name"];
                            bLookupHighway = true;
                        }

 
                        content.push("<fieldset>");
                        content.push("<legend><b>" + (index + 1) + ". " + name + "</b></legend>");
                        content.push("<i>Score:</i> " + "100");
                        content.push("<br/>");
                        content.push("<i>Address Found In</i> : " + "LANDMARKS");
                        content.push("<br/><br/>");
                        content.push("<div>Latitude (y):<div class='llValue'> " + geomLL.y + "</div></div>");
                        content.push("&nbsp;&nbsp;");
                        content.push("<div>Longitude (x):<div class='llValue'>" + geomLL.x + "</div></div>");
                        content.push("<br/><br/>");

                        var sIndex = index.toString();
                        content.push("<div id='divLRSInfo' class='highwayRowTitle' style='display:none'><b>Highway Information</b></div><br/>");
                        content.push("<div class='highwayRow'><div class='highwayField'>Name:</div> " + "<span class='highwayValue' id='divName" + sIndex + "'></span></div>" + "<br/>");
                        content.push("<div class='highwayRow'><div class='highwayField'>Route: </div> <span class='highwayValue'>" + rid + "</span></div><br/>");
                        content.push("<div class='highwayRow'><div class='highwayField'>Measure:</div> <span class='highwayValue'>" + measure + "</span></div><br/>");
                        content.push("<div class='highwayRow'><div class='highwayField'>Number of Lanes: </div>" + "<span class='highwayValue' id='divLanes" + sIndex + "'></span></div>" + "<br/>");
                        content.push("<div class='highwayRow'><div class='highwayField'>Speed Limit: </div>" + "<span class='highwayValue' id='divSpeedLimit" + sIndex + "'></span></div>" + "<br/>");

                        content.push("<div class='highwayRow'><div class='highwayField'>Functional Type:</div> " + "<span class='highwayValue' id='divFunctionalType" + sIndex + "'></span></div>" + "<br/>");
                        content.push("<div class='highwayRow'><div class='highwayField'>Functional Class: </div>" + "<span class='highwayValue' id='divFunctionalClass" + sIndex + "'></span></div>" + "<br/>");

                        content.push("<div class='highwayRow'><div class='highwayField'>Lane Width: </div>" + "<span class='highwayValue' id='divLaneWidth" + sIndex + "'></span></div>" + "<br/>");
                        content.push("<div class='highwayRow'><div class='highwayField'>Median Type Code: </div>" + "<span class='highwayValue' id='divMedianType" + sIndex + "'></span></div>" + "<br/>");
                        content.push("<div class='highwayRow'><div class='highwayField'>Left Shoulder Width: </div>" + "<span class='highwayValue' id='divShoulderL" + sIndex + "'></span></div>" + "<br/>");
                        content.push("<div class='highwayRow'><div class='highwayField'>Right Shoulder Width: </div>" + "<span class='highwayValue' id='divShoulderR" + sIndex + "'></span></div>" + "<br/>");

                        content.push("" + "</b></div><br/><br/>");

                        var gR = {};
                        gR.location = geomLL;
                        gR.address = name;

                        gR.MYINDEX = index.toString();
                        var a = { "MYID": index.toString() };

                        map.graphics.setOpacity(0);
                        showLocation(gR, a);

                        map.centerAndZoom(result.geometry, 10);


                        //
                        if (bLookupHighway) {

                            var offset = dojo.byId("offset").value;
                            var direction = dojo.byId("direction").value;

                            doRouteLookup(sIndex, rid, measure, offset, direction);

                        }
                        else {
                            map.graphics.setOpacity(1); 
                        }


                        content.push("<input type='button' value='Center At Address' onclick='zoomTo(" + geomLL.y + "," + geomLL.x + ")'/>");

                        rdiv.innerHTML += content.join("");

                    })
                    
                });
                
            }

            function showResults6(results) {
                var rdiv = dom.byId("resultsdiv");
                rdiv.innerHTML = "<p><b>Results : " + results.length + "</b></p>";


                //append with RH info
                for (var i = 0; i < results.length; i++) {



                }

                map.graphics.clear();
                var content = [];
                arrayUtils.forEach(results, function (result, index) {
                    var x = result.geometry.x.toFixed(5);
                    var y = result.geometry.y.toFixed(5);
                    var name = result.attributes["route_id"] + " - Mile Marker " + result.attributes["mile_point"];
                    content.push("<fieldset>");
                    content.push("<legend><b>" + (index + 1) + ". " + name + "</b></legend>");
                    content.push("<i>Score:</i> " + "100");
                    content.push("<br/>");
                    content.push("<i>Address Found In</i> : " + name);
                    content.push("<br/><br/>");
                    content.push("Latitude (y): " + y);
                    content.push("&nbsp;&nbsp;");
                    content.push("Longitude (x): " + x);
                    content.push("<br/><br/>");

                    var sIndex = index.toString();
                    content.push("<div id='divLRSInfo' style='display:none'><b>Highway Information ------<br/><br/>");
                    content.push("Name: " + "<span id='divName" + sIndex + "'></span>" + "<br/><br/>");
                    content.push("Route: " + result.attributes.route_id + "<br/><br/>");
                    content.push("Measure: " + result.attributes.measure + "<br/><br/>");
                    content.push("Number of Lanes: " + "<span id='divLanes" + sIndex + "'></span>" + "<br/><br/>");
                    content.push("Speed Limit: " + "<span id='divSpeedLimit" + sIndex + "'></span>" + "<br/><br/>");

                    content.push("-----------------" + "</b></div><br/><br/>");

                    //content.push("<b>GeoRSS-Simple</b><br/>");
                    //content.push("&lt;georss:point&gt;" + y + " " + x + "&lt;/georss:point&gt;");
                    //content.push("<br/><br/>");
                    //content.push("<b>GeoRSS-GML</b><br/>");
                    //content.push("&lt;georss:where&gt;&lt;gml:Point&gt;&lt;gml:pos&gt;" + y + " " + x + "&lt;/gml:pos&gt;&lt;gml:Point&gt;&lt;/georss:where&gt;");
                    //content.push("<br/><br/>");
                    //content.push("<b>Esri JSON</b><br/>");
                    //content.push("<b>WGS:</b> " + JSON.stringify(result.location.toJson()));
                    //content.push("<br/>");

                    var location_wm = webMercatorUtils.geographicToWebMercator(result.geometry);

                    //content.push("<b>WM:</b> " + JSON.stringify(location_wm.toJson()));
                    //content.push("<br/><br/>");
                    //content.push("<b>Geo JSON</b><br/>");
                    //content.push('"geometry": {"type": "Point", "coordinates": [' + y + ',' + x + ']}');
                    content.push("<br/><br/>");
                    var rid = result.attributes.route_id;
                    var measure = result.attributes.measure;
                    var offset = dojo.byId("offset").value;
                    var direction = dojo.byId("direction").value;


                    content.push("<input type='button' value='Center At Address' onclick='zoomTo(" + y + "," + x + ")'/>");
                    //content.push("<input style='margin-left:10px;' type='button' value='Select' onclick='doRouteLookup(" + sIndex + "," + "\"" + rid + "\"" + "," + measure + "," + offset + "," + "\"" + direction + "\"" + ")'/>");

                    //content.push("<input id='btnSelect" + index.toString() + "' style='margin-left:10px;' type='button' value='Select' />");
                    //onclick='doRouteLookup(" + sIndex + "," + "\"" + rid + "\"" + "," + measure + "," + offset + "," + "\"" + direction + "\"" + ")

                    //content.push("<input type='button' value='Center At Address' onclick='zoomTo(" + y + "," + x + ")'/>");
                    content.push("</fieldset>");

                    var gR = {};
                    gR.location = result.geometry;
                    gR.address = name;

                    gR.MYINDEX = index.toString();

                    showLocation(gR);

                });
                rdiv.innerHTML += content.join("");
            }

   

            //Perform the geocode. This function runs when the "Locate" button is pushed.
            function locate() {

                var sType = "ADDRESS";

                if (dom.byId("address").value != "" && dom.byId("intersection").value != "")
                    sType = "INTERSECTION";

                if (dom.byId("route").value != "" && dom.byId("milepost").value != "")
                    sType = "MILEMARKER";

                if (dom.byId("landmark").value != "" )
                    sType = "LANDMARK";

                if (sType == "ADDRESS") {
                    var address = {
                        SingleLine: dom.byId("address").value
                    };
                    var options = {
                        address: address,
                        outFields: ["*"]
                    };
                    //optionally return the out fields if you need to calculate the extent of the geocoded point
                    locator.addressToLocations(options);
                    $('#myTabs a:last').tab('show');
                }
                else if (sType == "INTERSECTION") {
                    alert("Intersections Not Available.")
                    return;

                    var q = new Query();
                    q.returnGeometry = true;
                    q.outFields = ["*"];

                    q.outSpatialReference = new SpatialReference({wkid:4326});
                    q.where = "intersectionname='" + dom.byId("address").value + " & " + dom.byId("intersection").value + "'";
                    var sURL = "https://dot4.esri.com/server/rest/services/Hosted/MassDOTStreetNameIntersections/FeatureServer/0";
                    var qT = new QueryTask(sURL);
                    qT.execute(q, function (results) {
                        //alert(results.features.length);
                        //.intersectionname
                        //.routeid
                        //.measure
                        showResults4(results.features);

                        var myFeatureExtent = graphicsUtils.graphicsExtent(map.graphics.graphics);
                        myFeatureExtent = myFeatureExtent.expand(3);
                        map.setExtent(myFeatureExtent);

                    },
                    function (error) {
                        console.log("error");
                    }
                    );
                    $('#myTabs a:last').tab('show');
                }
                else if (sType == "MILEMARKER") {
                    var q = new Query();
                    q.returnGeometry = true;
                    q.outFields = ["*"];
                    q.outSpatialReference = new SpatialReference({ wkid: 4326 });
                    q.where = "route_id='" + dom.byId("route").value + "' AND mile_point=" + dom.byId("milepost").value + "";
                    //var sURL = "https://dot4.esri.com/server/rest/services/Hosted/MassDOT_Mile_Markers/FeatureServer/0";
                    var sURL="http://dot.esri.com/server/rest/services/Hosted/MassDOT_Mile_Markers/FeatureServer/0"

                    var qT = new QueryTask(sURL);
                    qT.execute(q, function (results) {



                        //alert(results.features.length);
                        //.intersectionname
                        //.routeid
                        //.measure
                        showResults5(results.features);
                    },
                    function (error) {
                        console.log("error");
                    }
                    );

                    //$('#myTabs a:first').tab('show');
                }
                else if (sType == "LANDMARK") {
                    var q = new Query();
                    q.returnGeometry = true;
                    q.outFields = ["*"];
                    q.outSpatialReference = new SpatialReference({ wkid: 102100 });
                    q.where = "upper(landmark_name) = '" + dom.byId("landmark").value.toUpperCase() + "'";
                    //var sURL = "https://dot4.esri.com/server/rest/services/Hosted/MassDOT_Landmarks_Demo/FeatureServer/0";
                    var sURL="http://dot.esri.com/server/rest/services/Hosted/MassDOT_Landmarks_Demo/FeatureServer/0";
                    
                    var qT = new QueryTask(sURL);
                    qT.execute(q, function (results) {

                        showResults55(results.features);
                    },
                    function (error) {
                        console.log("error");
                    }
                    );

                    //$('#myTabs a:first').tab('show');
                }


                

            }

            function showLocation20(geocodeResult, attr) {
                //map.graphics.clear();

                //create a random color for the text and marker symbol
                var r = Math.floor(Math.random() * 250);
                var g = Math.floor(Math.random() * 100);
                var b = Math.floor(Math.random() * 100);

                var symbol = new SimpleMarkerSymbol(
                    SimpleMarkerSymbol.STYLE_CIRCLE,
                    20,
                    new SimpleLineSymbol(
                    SimpleLineSymbol.STYLE_SOLID,
                    new Color([r, g, b, 0.5]),
                    10
                    ), new Color([r, g, b, 0.9]));
                var pointMeters = webMercatorUtils.geographicToWebMercator(geocodeResult.location);
                var locationGraphic = new Graphic(pointMeters, symbol, attr);

                var font = new Font().setSize("12pt").setWeight(Font.WEIGHT_BOLD);
                var textSymbol = new TextSymbol(
                    geocodeResult.address,
                    font,
                    new Color([r, g, b, 0.8])
                ).setOffset(5, 15);


                map.graphics.add(locationGraphic);
                map.graphics.add(new Graphic(pointMeters, textSymbol, attr));

            }

            function showLocation(geocodeResult,attr) {
                //map.graphics.clear();

                //create a random color for the text and marker symbol
                var r = Math.floor(Math.random() * 250);
                var g = Math.floor(Math.random() * 100);
                var b = Math.floor(Math.random() * 100);

                var symbol = new SimpleMarkerSymbol(
                    SimpleMarkerSymbol.STYLE_CIRCLE,
                    20,
                    new SimpleLineSymbol(
                    SimpleLineSymbol.STYLE_SOLID,
                    new Color([r, g, b, 0.5]),
                    10
                    ), new Color([r, g, b, 0.9]));
                var pointMeters = webMercatorUtils.geographicToWebMercator(geocodeResult.location);
                var locationGraphic = new Graphic(pointMeters, symbol,attr);

                var font = new Font().setSize("12pt").setWeight(Font.WEIGHT_BOLD);
                var textSymbol = new TextSymbol(
                    geocodeResult.address,
                    font,
                    new Color([r, g, b, 0.8])
                ).setOffset(5, 15);

           
                map.graphics.add(locationGraphic);
                map.graphics.add(new Graphic(pointMeters, textSymbol, attr));

            }

            function zoomTo(lat, lon, label) {
                require([
                  "esri/geometry/Point", "esri/geometry/webMercatorUtils"
                ], function (Point, webMercatorUtils) {
                    var point = new Point(lon, lat, {
                        wkid: "4326"
                    });
                    var wmpoint = webMercatorUtils.geographicToWebMercator(point);
                    map.centerAndZoom(wmpoint,17);

                    if (label) {
                        var geocodeResult = {};
                        geocodeResult.address = "Geocode Result";
                        geocodeResult.location = point;
                        map.graphics.clear();
                        showLocation(geocodeResult);
                    }


                    //show tab
                    $('#myTabs a:last').tab('show');
                });
            }

            function clearUI() {
                dojo.byId("address").value = "";
                dojo.byId("intersection").value = "";
                dojo.byId("landmark").value = "";
                dojo.byId("route").value = "";
                dojo.byId("milepost").value = "";
                dojo.byId("offset").value = "";
                dojo.byId("direction").value = "";
            }
            function setupAddressUI(){
                clearUI();
                dojo.byId("address").value = "673 Boylston Ave, Boston, MA";
            }
            function setupLandmarksUI() {
                clearUI();
                dojo.byId("landmark").value = "Boylston Walmart";
            }
            function setupIntersectionUI() {
                clearUI();
                dojo.byId("address").value = "I93 NB";
                dojo.byId("intersection").value = "MASSACHUSETTS TURNPIKE";
            }

            function setupMileMarkerUI() {
                clearUI();
                dojo.byId("route").value = "I93 NB";
                dojo.byId("milepost").value = "18.2";
                dojo.byId("offset").value = "0";
                dojo.byId("direction").value = "N";
            }
        });
        function doSelect() {
            console.log("doselect");
        }
        function zoomTo(lat, lon, label) {
            require([
              "esri/geometry/Point", "esri/geometry/webMercatorUtils"
            ], function (Point, webMercatorUtils) {
                var point = new Point(lon, lat, {
                    wkid: "4326"
                });
                var wmpoint = webMercatorUtils.geographicToWebMercator(point);
                map.centerAndZoom(wmpoint, 17);
                
                if (label) {
                    var geocodeResult = {};
                    geocodeResult.address = "Geocode Result";
                    geocodeResult.location = point;
                    map.graphics.clear();
                    showLocation(geocodeResult);
                }


                //show tab
                $('#myTabs a:last').tab('show');
            });
        }

        function showLocation10(geocodeResult,locationGraphic) {
            //map.graphics.clear();

            //create a random color for the text and marker symbol
            var r = Math.floor(Math.random() * 250);
            var g = Math.floor(Math.random() * 100);
            var b = Math.floor(Math.random() * 100);

            var symbol = new esri.symbol.SimpleMarkerSymbol(
                esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,
                20,
                new esri.symbol.SimpleLineSymbol(
                esri.symbol.SimpleLineSymbol.STYLE_SOLID,
                new esri.Color([r, g, b, 0.5]),
                10
                ), new esri.Color([r, g, b, 0.9]));
            var pointMeters = geocodeResult.location;// esri.geometry.geographicToWebMercator(geocodeResult.location);
           // var locationGraphic = new esri.Graphic(pointMeters, symbol);

            var font = new esri.symbol.Font().setSize("12pt").setWeight("WEIGHT_BOLD");
            var textSymbol = new esri.symbol.TextSymbol(
                geocodeResult.address,
                font,
                new esri.Color([r, g, b, 0.8])
            ).setOffset(5, 15);
            //add the location graphic and text with the address to the map
            map.graphics.add(locationGraphic);
            map.graphics.add(new Graphic(locationGraphic.geometry, textSymbol));

        }

        function doRouteLookup(i,rid, measure, offset,direction) {
            //alert("todo: lookup info at " + rid + ", " + measure + ", " + offset);
            var index = i.toString();

            //esri/request
            var layerUrl = "https://dot2.esri.com/arcgis/rest/services/MassDOT/MassDOTLRSMap/MapServer/exts/LRSServer/networkLayers/0/queryAttributeSet";
            var locations = '[{"routeId":' + "\"" + rid + "\"" + ',"measure":' + measure + '}]';
            var attributeSet = '[{"layerId":12,"fields":["Facility"]},{"layerId":15,"fields":["F_Class"]},{"layerId":46,"fields":["St_Name"]}, {"layerId":42,"fields":["Speed_Lim"]}, {"layerId":24,"fields":["Med_Type"]}, {"layerId":29,"fields":["Num_Lanes"]}, {"layerId":22,"fields":["Lane_Width"]}, {"layerId":38,"fields":["Shldr_Lt_W"]}, {"layerId":39,"fields":["Shldr_Rt_W"]}]';

            var sURL = layerUrl + "?locations=" + locations + "&attributeSet=" + attributeSet;

            //locations=%5B%7B%22routeId%22%3A%22I495+SB%22%2C%22measure%22%3A64.620761%7D%5D&attributeSet=%5B%7B%22layerId%22%3A46%2C%22fields%22%3A%5B%22St_Name%22%5D%7D%2C+%7B%22layerId%22%3A42%2C%22fields%22%3A%5B%22Speed_Lim%22%5D%7D%2C+%7B%22layerId%22%3A24%2C%22fields%22%3A%5B%22Med_Type%22%5D%7D%2C+%7B%22layerId%22%3A29%2C%22fields%22%3A%5B%22Num_Lanes%22%5D%7D%2C+%7B%22layerId%22%3A22%2C%22fields%22%3A%5B%22Lane_Width%22%5D%7D%2C+%7B%22layerId%22%3A38%2C%22fields%22%3A%5B%22Shldr_Lt_W%22%5D%7D%2C+%7B%22layerId%22%3A39%2C%22fields%22%3A%5B%22Shldr_Rt_W%22%5D%7D%5D&temporalViewDate=&outSR=&gdbVersion";
            var layersRequest =  esri.request({
                url: sURL,
                content: { f: "json" },
                handleAs: "json",
                callbackParamName: "callback"
            });
            layersRequest.then(
              function (response) {
                  console.log("Success: ", response);

                  var lanes = response.features[0].attributes.Num_Lanes;
                  var speed = response.features[0].attributes.Speed_Lim;
                  var name = response.features[0].attributes.St_Name;

                  function getFClass(s) {

                      var s2 = parseInt(s);
                      if (s2 == 0) {
                          return "Local";
                      }
                      else if (s2 == 1) {
                          return "Interstate";
                      }
                      else if (s2 == 2) {
                          return "Rural or urban principal arterial";
                      }
                      else if (s2 == 3) {
                          return "Rural minor arterial or urban principal arterial";
                      }
         
                      else if (s2 == 5) {
                          return "Urban minor arterial or rural major collector";
                      }
                      else if (s2 == 6) {
                          return "Urban collector or rural minor collector";
                      }
                      else if (s2 == 7) {
                          return "Ramp - Interstate";
                      }
                      else if (s2 == 8) {
                          return "Ramp - Non-Interstate";
                      }
                      //{
                      //    name: "Local",
                      //    code: 0
                      //},
                      //{
                      //    name: "Interstate",
                      //    code: 1
                      //},
                      //{
                      //    name: "Rural or urban principal arterial",
                      //    code: 2
                      //},
                      //{
                      //    name: "Rural minor arterial or urban principal arterial",
                      //    code: 3
                      //},
                      //{
                      //    name: "Urban minor arterial or rural major collector",
                      //    code: 5
                      //},
                      //{
                      //    name: "Urban collector or rural minor collector",
                      //    code: 6
                      //},
                      //{
                      //    name: "Ramp - Interstate",
                      //    code: 7
                      //},
                      //{
                      //    name: "Ramp - Non-Interstate",
                      //    code: 8
                      //}


                      return s;
                  }

                  function getFacility(s) {

                      var s2 = parseInt(s);
                      
       
                      if (s2 == 1) {
                          return "One-Way Roadway";
                      }
                      else if (s2 == 2) {
                          return "Two-Way Roadway";
                      }
                      else if (s2 == 3) {
                          return "Couplet";
                      }

                      else if (s2 == 4) {
                          return "Ramp";
                      }
                      else if (s2 == 5) {
                          return "Non Mainline";
                      }
                      else if (s2 == 6) {
                          return "Non Inventory Direction";
                      }
                      
                      return s;
                  }

                  var fClass = getFClass( response.features[0].attributes.F_Class);
                  var fType = getFacility(response.features[0].attributes.Facility);

                  var newMeasure = response.features[0].attributes.measure;

                  var laneWidth = response.features[0].attributes.Lane_Width;
                  var medianType = response.features[0].attributes.Med_Type;
                  var shoulderL=response.features[0].attributes.Shldr_Lt_W;
                  var shoulderR =response.features[0].attributes.Shldr_Rt_W;

                  if(lanes)dojo.byId("divLanes" + index).innerText = lanes.toString();
                  if(fClass)dojo.byId("divFunctionalClass" + index).innerText = fClass.toString();
                  if(fType)dojo.byId("divFunctionalType" + index).innerText = fType.toString();
                  if(speed)dojo.byId("divSpeedLimit" + index).innerText = speed.toString();
                  if(name)dojo.byId("divName" + index).innerText = name.toString();

                  if(laneWidth)dojo.byId("divLaneWidth" + index).innerText = laneWidth.toString();
                  if(medianType)dojo.byId("divMedianType" + index).innerText = medianType.toString();
                  if(shoulderL)dojo.byId("divShoulderL" + index).innerText = shoulderL.toString();
                  if(shoulderR)dojo.byId("divShoulderR" + index).innerText = shoulderR.toString();

                  dojo.byId("divLRSInfo").style.display = "block";





                  if (0 == 0) {
                        var layerUrl = "https://dot2.esri.com/arcgis/rest/services/MassDOT/FindMassDOTOffset/GPServer/FindMassDOTOffset/execute";

                        //Route_ID_to_find=I495+SB&Measure_to_find=64.620761&Offset=300.00&Direction=N&

                        //var layerUrl = "https://dot2.esri.com/arcgis/rest/services/MassDOT/MassDOTLRSMap/MapServer/exts/LRSServer/networkLayers/0/queryAttributeSet";
                        var locations = 'Route_ID_to_find='  + rid  + '&Measure_to_find=' + newMeasure + "&Offset=" + offset +"&Direction=" + direction;
                        //var attributeSet = '[{"layerId":46,"fields":["St_Name"]}, {"layerId":42,"fields":["Speed_Lim"]}, {"layerId":24,"fields":["Med_Type"]}, {"layerId":29,"fields":["Num_Lanes"]}, {"layerId":22,"fields":["Lane_Width"]}, {"layerId":38,"fields":["Shldr_Lt_W"]}, {"layerId":39,"fields":["Shldr_Rt_W"]}]';

                        var sURL = layerUrl + "?" + locations + "&env%3AoutSR=102100";

                        //locations=%5B%7B%22routeId%22%3A%22I495+SB%22%2C%22measure%22%3A64.620761%7D%5D&attributeSet=%5B%7B%22layerId%22%3A46%2C%22fields%22%3A%5B%22St_Name%22%5D%7D%2C+%7B%22layerId%22%3A42%2C%22fields%22%3A%5B%22Speed_Lim%22%5D%7D%2C+%7B%22layerId%22%3A24%2C%22fields%22%3A%5B%22Med_Type%22%5D%7D%2C+%7B%22layerId%22%3A29%2C%22fields%22%3A%5B%22Num_Lanes%22%5D%7D%2C+%7B%22layerId%22%3A22%2C%22fields%22%3A%5B%22Lane_Width%22%5D%7D%2C+%7B%22layerId%22%3A38%2C%22fields%22%3A%5B%22Shldr_Lt_W%22%5D%7D%2C+%7B%22layerId%22%3A39%2C%22fields%22%3A%5B%22Shldr_Rt_W%22%5D%7D%5D&temporalViewDate=&outSR=&gdbVersion";
                        var layersRequest = esri.request({
                            url: sURL,
                            content: { f: "json" },
                            handleAs: "json",
                            callbackParamName: "callback"
                        });
                        layersRequest.then(
                          function (response) {
                              console.log("Success: ", response);
                       
                              var nl = response.results[0].value.features[0].geometry;
                              var sr=response.results[0].value.spatialReference;

                              var newLocation = new esri.geometry.Point(nl.x,nl.y,sr);
                              //newLocation.type = "point";
                              //newLocation.spatialReference=response.results[0].value.spatialReference;

                              for (var i = 0; i < map.graphics.graphics.length; i++) {
                                  var f = map.graphics.graphics[i];
                                  if (f.attributes && f.attributes.MYID == index) {
                                      f.setGeometry( newLocation);
                                  }
                              }

                              map.graphics.setOpacity(1);

                              //(xmin, ymin, xmax, ymax, spatialReference)
                              //var tol = 1000;
                              //var xmin = nl.x - tol;
                              //var xmax = nl.x + tol;
                              //var ymin = nl.y - tol;
                              //var ymax = nl.y + tol;

                              //var myFeatureExtent = new esri.geometry.Extent(xmin, ymin, xmax, ymax, sr);// graphicsUtils.graphicsExtent(map.graphics.graphics);
                              //map.extent=myFeatureExtent;


                              //var gR = {};
                              //gR.location = response.results[0].value.features[0].geometry;
                              //gR.address = name;

                              //var gR2 = new esri.Graphic();

                              //gR2.geometry = gR.location;

                              //map.graphics.clear();
                              //showLocation10(gR,gR2);

                              //var lanes = response.features[0].attributes.Num_Lanes;
                              //var speed = response.features[0].attributes.Speed_Lim;
                              //var name = response.features[0].attributes.St_Name;

                              //dojo.byId("divLanes" + index).innerText = lanes.toString();
                              //dojo.byId("divSpeedLimit" + index).innerText = speed.toString();
                              //dojo.byId("divName" + index).innerText = name.toString();
                              //dojo.byId("divLRSInfo").style.display = "block";



                          }, function (error) {
                              console.log("Error: ", error.message);
                          });

                    }






              }, function (error) {
                  console.log("Error: ", error.message);
              });

        }

    </script>

</head>

<body class="claro">
    <div id="headerRow" class="row">

        <img src="images/massDOTBanner-IntroPage.png" />

    </div>

    <div id="mainInput" class="row">
        <div class="col-6">
            <div id="examples">
                <button id="btnAddress" data-dojo-type="dijit/form/Button">Address</button>
                <button id="btnIntersection" data-dojo-type="dijit/form/Button">Intersection</button>
                <button id="btnMileMarker" data-dojo-type="dijit/form/Button">Mile Marker</button>
                <button id="btnLandmarks" data-dojo-type="dijit/form/Button">Landmarks</button>
            </div>
            <div id="searchRow">
                <div>
                    Where Did the Crash Occur:
                    <div id="search"></div>
                </div>
            </div>
            <div id="inputRow">
                <div>
                    <div class="input-group">
                        <label class="input-label"> Street:</label>
                        <input class="input-value" type="text"  id="address" placeholder=""  value="" />
                    </div>

                    <div class="input-group">
                        <label class="input-label"> Intersection:</label>
                        <input class="input-value" type="text"  id="intersection"  value="" />
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            Landmark:
                        </label>
                        <input class="input-value" type="text"  id="landmark"  value="" />
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            Route:
                        </label>
                        <input class="input-value" type="text"  id="route"  value="" />
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            Mile Marker:
                        </label>
                        <input class="input-value" type="text"  id="milepost"  value="" />
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            Offset:
                        </label>
                        <input class="input-value" type="text" id="offset" value="" />
                    </div>


                    <div class="input-group">
                        <label class="input-label">
                            Offset Direction:
                        </label>
                        <input class="input-value" type="text" id="direction" value="" />
                    </div>

                    <div class="input-group">
                        <label class="input-label">
                            Exit:
                        </label>
                        <input class="input-value" type="text"  id="exit"  value="" />
                    </div>

                    <button id="locate" data-dojo-type="dijit/form/Button">Locate</button>
                </div>
            </div>


        </div>

        <div class="col-6">
            <ul class="nav nav-pills" id="myTabs" role="tablist">
                <li role="presentation"><a href="#myresults" aria-controls="myresults" role="tab" data-toggle="tab">Results</a></li>
                <li role="presentation"><a href="#mymap" aria-controls="mymap" role="tab" data-toggle="tab">Map</a></li>
            </ul>
            <div class="tab-content" id="tab-content">
                <div role="tabpanel" class="tab-pane " id="myresults">
                    <div id="results">
                        <div id="currentextent"></div>
                        <div id="resultsdiv"></div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane active" id="mymap">
                    <div  id="map">

                    </div>
                </div>

            </div>
        </div>

    </div>

    <div id="mainRow" class="row">



        <div class="col-6" id="t1">




        </div>


    </div>
</body>
</html>
